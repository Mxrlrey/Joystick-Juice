{% extends 'base.html' %}
{% load static %}

{% block css %}
<link href="{% static 'css/games.css' %}" rel="stylesheet">
{% endblock %}

{% block title %}gamezinho{% endblock %}

{% block content %}

<h1 class="jogao">Cuphead</h1>

<h3 class="descricao">Entre no universo vibrante e maluco inspirado nos desenhos animados dos anos 1930.
     Em Cuphead, voc√™ e seu irm√£o Mugman embarcam em uma jornada para pagar uma d√≠vida com o pr√≥prio Diabo.
     Prepare-se para chefes gigantes, fases cheias de a√ß√£o e um desafio implac√°vel que vai testar sua paci√™ncia
     e reflexos. Tudo isso com uma trilha sonora jazz√≠stica e anima√ß√µes feitas √† m√£o que parecem ter sa√≠do direto
     de um filme antigo.</h3>

<div class="tag">
   <h3 class="tags"> Tags: </h3>
   <span class="tagss"> cuphead, jogo de plataforma, run and gun, coop local, jogo retr√¥, anima√ß√£o anos 30,
     jogo dif√≠cil, chefes desafiadores, indie, mdhr, desenho animado, boss fight, bullet hell,
     a√ß√£o, aventura
   </span>
</div>

<!-- Gr√°fico/Avalia√ß√£o -->
<h2 class="avlctitulo">Avalia√ß√µes</h2>

<div class="avaliacao-container">
  
  <!-- painel do lado esquerdo -->
  <div class="painel-acoes">
    <div class="botoes-rapidos">
      <button class="acao">üëÅ Assistir</button>
      <button class="acao">‚ù§Ô∏è Curtir</button>
      <button class="acao">üìå Lista</button>
    </div>

    <div class="avaliar">
      <p>Avaliar:</p>
      <div class="estrelas" id="estrelas">
        <span data-valor="1">‚òÖ</span>
        <span data-valor="2">‚òÖ</span>
        <span data-valor="3">‚òÖ</span>
        <span data-valor="4">‚òÖ</span>
        <span data-valor="5">‚òÖ</span>
      </div>
      <p id="nota-escolhida">Sem avalia√ß√£o</p>
    </div>
  </div>

  <!-- gr√°fico do lado direito -->
  <div class="avaliacao">
    <div class="chart-container" id="chart"></div>
  </div>
</div>

<script>
  const votos = {
    "0.5": 5,
    "1.0": 8,
    "1.5": 12,
    "2.0": 18,
    "2.5": 30,
    "3.0": 45,
    "3.5": 60,
    "4.0": 80,
    "4.5": 95,
    "5.0": 80
  };

  const valores = ["0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"];

  const total = Object.values(votos).reduce((a,b) => a + b, 0);
  const maxCount = Math.max(...Object.values(votos));
  const chart = document.getElementById('chart');

  valores.forEach(valStr => {
    const count = votos[valStr] || 0;
    const percent = total ? Math.round((count / total) * 100) : 0;
    const height = maxCount ? (count / maxCount) * 140 : 0; // escala at√© 110px

    const col = document.createElement('div');
    col.className = 'bar-column';

    // label de valor (aparece s√≥ no hover). Formata 1.0 como "1,0" e 2.5 como "2,5"
    const displayVal = Number(valStr).toFixed(1).replace('.', ',');
   
    // barra
    const bar = document.createElement('div');
    bar.className = 'bar-fill';
    bar.style.height = height + 'px';

    

    // tabela de detalhe (aparece no hover)
    const ratingBox = document.createElement('div');
    ratingBox.className = 'rating-table';
    ratingBox.innerHTML = `
      <table>
        <thead>
          <tr><th>Nota</th><th>Detalhe</th></tr>
        </thead>
        <tbody>
          <tr><td>${displayVal}</td><td>Votos: ${count}</td></tr>
          <tr><td>%</td><td>${percent}%</td></tr>
          <tr><td>Total</td><td>${total}</td></tr>
        </tbody>
      </table>
    `;

    // ordem dos elementos: label (absoluta), barra, contador, tabela
   
    col.appendChild(bar);
    col.appendChild(ratingBox);
    chart.appendChild(col);
  });

   // ---- sistema de estrelas ----
  const estrelas = document.querySelectorAll('#estrelas span');
  const saida = document.getElementById('nota-escolhida');
  estrelas.forEach(e => {
    e.addEventListener('click', () => {
      const nota = e.dataset.valor;
      estrelas.forEach(s => s.classList.remove('ativo'));
      for (let i = 0; i < nota; i++) estrelas[i].classList.add('ativo');
      saida.textContent = `Voc√™ avaliou com ${nota} estrela${nota>1?'s':''}`;
    });
  });

</script>


{% endblock %}

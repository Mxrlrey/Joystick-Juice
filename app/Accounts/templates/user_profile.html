{% extends 'base.html' %}
{% load static %}

{% block title %}Perfil{% endblock %}

{% block css %}
<link href="{% static 'css/profile.css' %}" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Press+Start+2P&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="profile">
      <div class="profile-header">
        <div class="avatar-container">
          <div class="avatar">
            {% if user.avatar %}
              <img class="avatar-img" src="{{ user.avatar.url }}" alt="Avatar do usuário">
            {% else %}
              {{ object.name|slice:":1"|upper }}
            {% endif %}
          </div>
        </div>
        
        <div class="user-info">
          <div class="content-edit">
            <h2>{{ object.name }}</h2>
            <div class="modal fade " id="updateModal{{ object.pk }}" tabindex="-1" aria-labelledby="updateModalLabel{{ object.pk }}" aria-hidden="true">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <form method="POST" action="{% url 'user_update' object.pk %}">
                      <div class="modal-header">
                        <h5 class="modal-title text-center w-100">Editar Perfil</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        {% csrf_token %}
                        {{ update_form }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                      </div>
                  </form>
                </div>
              </div>
            </div>
            <div>
              <a href="javascript:history.back()" class="btn btn-outline-secondary">Voltar</a>
              <button type="button" class="btn btn-outline-primary btn-editar" data-bs-toggle="modal" data-bs-target="#updateModal{{ object.pk }}">Editar</button>
            </div>
          </div>
          {% if object.username %}
            <span class="username">@{{ object.username }}</span>
          {% endif %}
          
          <div class="user-meta">
            <div class="meta-item">
              <strong>Email</strong>
              <span>{{ object.email }}</span>
            </div>

            <div class="meta-item">
              <strong>Data de nascimento</strong>
              <span>{{ object.birthdate }}</span>
            </div>
            
            <div class="meta-item">
              <strong>Gênero</strong>
              <span>
                {% if object.gender == 'M' %}Masculino
                {% elif object.gender == 'F' %}Feminino
                {% else %}Outro{% endif %}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="bio-section">
        <div class="modal fade " id="editBioModal{{ object.pk }}" tabindex="-1" aria-labelledby="editBioModalLabel{{ object.pk }}" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <form method="POST" action="{% url 'user_bio' object.pk %}">
                  <div class="modal-header">
                    <h5 class="modal-title text-center w-100">Editar Biografia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    {% csrf_token %}
                    {{ bio_form }}
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                  </div>
              </form>
            </div>
          </div>
        </div>
        <div class="bio" style="display: flex; align-items: center; gap: 8px;">
          <h3 class="mb-2" style="margin: 0; line-height: 1;">Biografia</h3>
          
          <a href="#" class="edit-icon ms-1 mb-2" data-bs-toggle="modal" data-bs-target="#editBioModal{{ object.pk }}" title="Editar biografia">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#F17A0D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
            </svg>
          </a>
        </div>
        <div class="bio-content">
          {% if object.bio %}
            {{ object.bio }}
          {% else %}
            <p class="bio-empty">Biografia não cadastrada.</p>
          {% endif %}
        </div>
      </div>
    </div>
{% endblock %}